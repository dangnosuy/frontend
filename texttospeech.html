<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Text To Speech | AlchemistAI</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="./css/texttospeech.css" />
  <link rel="stylesheet" href="./css/header.css">
</head>

<body>
  <header>
    <button class="menu-toggle">
      <i class="fas fa-bars"></i>
    </button>
    <div class="logo">
      <img style="border: 2px solid #3b82f6 ;" class="w-16 h-16 rounded-full object-cover" src="./asserts/images/logo.png"
        alt="Logo" />
      <span class="logo_text" style="background: linear-gradient(90deg, #00c6ff, #7d51f1, #a855f7);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;" class="text-xl font-bold">
        AlchemistAI</span>
    </div>
    <nav class="menu">
      <a href="index.html" class="text-white no-underline font-extrabold hover:text-green-300 pb-1 text-lg">Home</a>
      <a href="#" class="text-blue-600 font-extrabold border-b-2 border-blue-600 pb-1 hover:text-blue-700 text-lg">Text
        to Speech</a>
      <a href="texttoimage.html" class="text-white no-underline font-extrabold hover:text-green-300 pb-1 text-lg">Text
        to Image</a>
      <a href="texttomusic.html" class="text-white no-underline font-extrabold  hover:text-green-300 pb-1 text-lg">Text
        to Music</a>
      <a href="texttovideo.html" class="text-white no-underline font-extrabold  hover:text-green-300 pb-1 text-lg">Text
        to Video</a>
    </nav>
    <div class="login-container">
      <a href="sign_in.html" id="sign_in" class="login-button">Login</a>
    </div>
    <div class="avatar-container">
      <div style="color: aliceblue; margin-right: 0.75rem; justify-self: center; align-self: center;" id="user-balance">ƒêang t·∫£i‚Ä¶</div>
      <img src="./asserts/images/ho.jpg" alt="User Avatar" class="avatar" id="avatarImg">
      <!-- Dropdown Menu -->
      <div class="dropdown-menu" id="dropdownMenu">
        <a href="profile.html" class="dropdown-menu-item">
          <i class="fas fa-user"></i>
          <span>Profile</span>
        </a>
        <div class="dropdown-divider"></div>
        <a href="settings.html" class="dropdown-menu-item">
          <i class="fas fa-cog"></i>
          <span>Settings</span>
        </a>
        <div class="dropdown-divider"></div>
        <a href="https://36f20c06-9031-4599-91da-7ec3a0e1a861-00-1jytyyr3v3x2w.pike.replit.dev/payment" class="dropdown-menu-item">
          <i class="fas fa-money-bill"></i>
          <span>Payment</span>
        </a>
        <div class="dropdown-divider"></div>
        <a href="sign_in.html" class="dropdown-menu-item logout">
          <i class="fas fa-sign-out-alt"></i>
          <span>Log out</span>
        </a>
      </div>
    </div>
    </div>
  </header>

  <main style="background: #0a0425 url('https://img.freepik.com/free-vector/colorful-wavy-background_23-2148494696.jpg?t=st=1744525839~exp=1744529439~hmac=79f342806727a0519b017c97358513949e42e72532324180342328c049d7ac9c&w=2000') no-repeat center center fixed;
       background-size: cover;">
    <!-- ph·∫ßn gi·ªõi thi·ªáu trang -->
    <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold mb-4">Text To Speech</h1>
    <div class="text mb-4">
      Bring your words to life with voice. Enter your text, choose a voice, and let AI turn it into natural speech
    </div>
    <!-- Main Workspace -->
    <div class="workspace">
      <div class="text-input-container hover:transform hover:scale-[1.02] transition-all duration-300">
        <div class="tab-buttons">
          <button class="tab-button active" data-tab="text-panel">Text Input</button>
          <button class="tab-button" data-tab="file-panel">File Input</button>
        </div>
        <label for="file-prompt" class="block text-sm font-medium text-gray-300 mb-2">Enter prompt for processing
          the audio file:</label>
        <div class="tab-content">

          <div id="text-panel" class="tab-panel active">
            <textarea id="textInput" placeholder="Enter text to convert to speech"></textarea>
          </div>

          <div id="file-panel" class="tab-panel" style="display: none;">
            <!-- Prompt Section First -->
            <div class="prompt-section mb-4">

              <textarea id="file-prompt"
                class="w-full h-24 bg-white/5 border border-gray-600 rounded-lg p-3 text-gray-100 focus:border-blue-500 focus:ring focus:ring-blue-500/30 transition-all"
                placeholder="E.g., 'Transcribe this audio file' or 'Summarize the content of this recording'"></textarea>
            </div>

            <!-- File Upload Section Second -->
            <div class="file-upload-section mb-4">
              <label for="file-upload"
                class="custom-file-upload flex flex-col items-center justify-center p-6 border-2 border-dashed border-gray-400 rounded-lg hover:border-blue-400 transition-all duration-300 cursor-pointer">
                <i class="fas fa-cloud-upload-alt text-2xl mb-2"></i>
                <span class="text-lg">Click or Drag & Drop File</span>
                <span class="text-sm text-gray-300 mt-1">Accepts: .mp3, .wav</span>
              </label>
              <input id="file-upload" type="file" accept=".mp3,.wav" style="display: none;" />
              <div id="file-display" class="hidden mt-3">
                <div class="flex items-center justify-between p-2 bg-white/10 rounded-lg border border-gray-500">
                  <div class="flex items-center">
                    <i class="fas fa-file-audio text-blue-400 mr-2"></i>
                    <span id="file-name" class="text-sm truncate max-w-xs">No file selected</span>
                  </div>
                  <button id="remove-file" class="text-red-400 hover:text-red-500 transition-colors">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
              <div class="actions">
                <button type="button" id="startBtn1"
                  class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transform hover:scale-105 transition-all duration-300 hover:shadow-lg hover:shadow-yellow-500/30">üé§
                  B·∫•m ƒë·ªÉ n√≥i</button>
                <button id="genFromFile"
                  class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transform hover:scale-105 transition-all duration-300 hover:shadow-lg hover:shadow-blue-500/30">Generate</button>
                <button id="clearPrompt"
                  class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transform hover:scale-105 transition-all duration-300 hover:shadow-lg hover:shadow-red-500/30">Clear</button>
              </div>
            </div>

            <!-- Processing Options Last -->
          </div>


        </div>

        <div class="controls">
          <div class="params">
            <select id="language" name="language"
              class="p-2 sm:p-2 text-sm sm:text-base border rounded-lg bg-white/5 text-gray-100 hover:bg-white/10 transition-all duration-300 cursor-pointer hover:border-blue-500">
              <option value="Ti·∫øng Vi·ªát" selected class="bg-[#0f0149] text-white">Ti·∫øng Vi·ªát</option>
              <option value="Ti·∫øng Anh" class="bg-[#0f0149] text-white">Ti·∫øng Anh</option>
              <option value="Ti·∫øng T√¢y Ban Nha" class="bg-[#0f0149] text-white">Ti·∫øng T√¢y Ban Nha</option>
              <option value="Ti·∫øng Ph√°p" class="bg-[#0f0149] text-white">Ti·∫øng Ph√°p</option>
              <option value="Ti·∫øng ƒê·ª©c" class="bg-[#0f0149] text-white">Ti·∫øng ƒê·ª©c</option>
              <option value="Ti·∫øng √ù" class="bg-[#0f0149] text-white">Ti·∫øng √ù</option>
              <option value="Ti·∫øng B·ªì ƒê√†o Nha" class="bg-[#0f0149] text-white">Ti·∫øng B·ªì ƒê√†o Nha</option>
              <option value="Ti·∫øng Ba Lan" class="bg-[#0f0149] text-white">Ti·∫øng Ba Lan</option>
              <option value="Ti·∫øng Th·ªï Nhƒ© K·ª≥" class="bg-[#0f0149] text-white">Ti·∫øng Th·ªï Nhƒ© K·ª≥</option>
              <option value="Ti·∫øng Nga" class="bg-[#0f0149] text-white">Ti·∫øng Nga</option>
              <option value="Ti·∫øng H√† Lan" class="bg-[#0f0149] text-white">Ti·∫øng H√† Lan</option>
              <option value="Ti·∫øng S√©c" class="bg-[#0f0149] text-white">Ti·∫øng S√©c</option>
              <option value="Ti·∫øng ·∫¢ R·∫≠p" class="bg-[#0f0149] text-white">Ti·∫øng ·∫¢ R·∫≠p</option>
              <option value="Ti·∫øng Trung (gi·∫£n th·ªÉ)" class="bg-[#0f0149] text-white">Ti·∫øng Trung (gi·∫£n
                th·ªÉ)</option>
              <option value="Ti·∫øng Nh·∫≠t" class="bg-[#0f0149] text-white">Ti·∫øng Nh·∫≠t</option>
              <option value="Ti·∫øng Hungary" class="bg-[#0f0149] text-white">Ti·∫øng Hungary</option>
              <option value="Ti·∫øng H√†n" class="bg-[#0f0149] text-white">Ti·∫øng H√†n</option>
              <option value="Ti·∫øng Hindi" class="bg-[#0f0149] text-white">Ti·∫øng Hindi</option>
            </select>

            <select id="gender" name="voice"
              class="p-2 border rounded-lg bg-white/5 text-gray-100 hover:bg-white/10 transition-all duration-300 cursor-pointer hover:border-blue-500">
              <option value="male" selected class="bg-[#374151] text-white">Male voice</option>
              <option value="female" class="bg-[#374151] text-white">Female voice</option>
            </select>
            <select id="male_styles" name="voice"
              class="p-2 border rounded-lg bg-white/5 text-teal-300 hover:bg-white/10 transition-all duration-300 cursor-pointer hover:border-teal-500">
              <option value="calm" selected class="bg-[#0f0149] text-white">Calm</option>
              <option value="cham" selected class="bg-[#0f0149] text-white">Slow</option>
              <option value="nhanh" selected class="bg-[#0f0149] text-white">Fast</option>
              <option value="truyencam" selected class="bg-[#0f0149] text-white">Inspirational</option>
            </select>
            <select id="female_styles" name="voice"
              class="p-2 border rounded-lg bg-white/5 text-teal-300 hover:bg-white/10 transition-all duration-300 cursor-pointer hover:border-teal-500">
              <option value="calm" selected class="bg-[#0f0149] text-white">Calm</option>
              <option value="cham" selected class="bg-[#0f0149] text-white">Slow</option>
              <option value="luuloat" selected class="bg-[#0f0149] text-white">Fluency</option>
              <option value="nhannha" selected class="bg-[#0f0149] text-white">Smooth</option>
              <option value="nhenhang" selected class="bg-[#0f0149] text-white">Lightly</option>
            </select>
          </div>
          <div class="actions">
            <button type="button" id="startBtn"
                  class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transform hover:scale-105 transition-all duration-300 hover:shadow-lg hover:shadow-yellow-500/30">üé§
                  B·∫•m ƒë·ªÉ n√≥i</button>
            <button id="generateBtn"
              class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transform hover:scale-105 transition-all duration-300 hover:shadow-lg hover:shadow-blue-500/30">Generate</button>
            <button id="clearBtn"
              class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transform hover:scale-105 transition-all duration-300 hover:shadow-lg hover:shadow-red-500/30">Clear</button>
          </div>
        </div>
      </div>
      <div class="output-container hover:transform hover:scale-[1.02] transition-all duration-300">
        <label for="Recordings" class="tilte">Your generated audio</label>
        <div class="recording-item">
          <audio id="audio-player" controls src="">
            <source src="" type="audio/mpeg" />
            Your browser does not support the audio element.
          </audio>
        </div>
      </div>
    </div>
    <div class="extension">
      <!-- Chat History Sidebar -->
      <div class="chat-history hover:transform hover:scale-[1.02] transition-all duration-300">
        <h3 class="history-title">History</h3>
      </div>
    </div>
  <section class="sect py-10" style="background-color: rgba(0, 0, 0, 0.6)">
        <div class="max-w-7xl mx-auto px-4">
          <h2 class="text-3xl font-bold text-white mb-6 text-center">
            C√°ch Th·ª©c Ho·∫°t ƒê·ªông
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="bg-gray-700 p-6 rounded-lg shadow">
              <h3 class="text-xl font-semibold text-white mb-2">
                B∆∞·ªõc 1: Nh·∫≠p VƒÉn B·∫£n
              </h3>
              <p class="text-gray-300">
                H√£y nh·∫≠p ƒëo·∫°n text ho·∫∑c ch·ªçn file m√† b·∫°n mu·ªën chuy·ªÉn th√†nh √¢n thanh .
              </p>
            </div>
            <div class="bg-gray-700 p-6 rounded-lg shadow">
              <h3 class="text-xl font-semibold text-white mb-2">
                B∆∞·ªõc 2: T√πy Ch·ªçn Th·ªÉ Lo·∫°i
              </h3>
              <p class="text-gray-300">
                Ch·ªçn ng√¥n ng·ªØ, gi·ªõi t√≠nh v√† phong c√°ch ƒë·ªÉ t·∫°o √¢m thanh c·ªßa b·∫°n.
              </p>
            </div>
            <div class="bg-gray-700 p-6 rounded-lg shadow">
              <h3 class="text-xl font-semibold text-white mb-2">
                B∆∞·ªõc 3: T·∫°o ·∫¢nh
              </h3>
              <p class="text-gray-300">
                Nh·∫≠n ngay ƒëo·∫°n √¢m thanh ƒë∆∞·ª£c t·∫°o b·ªüi tr√≠ tu·ªá nh√¢n t·∫°o, b·∫°n c√≥ th·ªÉ th∆∞·ªüng th·ª©c n√≥.
              </p>
            </div>
          </div>
        </div>
      </section>
      <section class="sect py-10" style="background-color: rgba(0, 0, 0, 0.6);">
      <div class="max-w-7xl mx-auto px-4">
        <h2 class="text-3xl font-bold text-white mb-6 text-center">ƒê√°nh Gi√° T·ª´ Ng∆∞·ªùi D√πng</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <div class="bg-white p-6 rounded-lg shadow">
            <p class="text-gray-600 italic">"S·∫Ω c√≥ 1 ng√†y nh·ªØng ƒëo·∫°n √¢m thanh c·ªßa AlchemistAI s·∫Ω 
              thay th·ªÉ ch√∫ng t√¥iüòÇüòÇ."</p>
            <h4 class="text-lg font-bold text-gray-800 mt-4">L·∫°i VƒÉn S√¢m</h4>
          </div>
          <div class="bg-white p-6 rounded-lg shadow">
            <p class="text-gray-600 italic">"M·ªói khi t√¥i nh·∫≠n cu·ªôc g·ªçi t·ª´ ng√†i Putin (T·ªïng th·ªëng Nga)
              t√¥i ph·∫£i r·∫•t c·∫©n th·∫≠n v√¨ s·ª£ r·∫±ng b·∫£n th√¢n ch·ªâ ƒëang n√≥i chuy·ªán v·ªõi AlchemistAI !!!"</p>
            <h4 class="text-lg font-bold text-gray-800 mt-4">Donald Trump</h4>
          </div>
        </div>
      </div>
    </section>
    <section class="py-10 sect" style="background-color: rgba(0, 0, 0, 0.6);">
      <div class="max-w-7xl mx-auto px-4">
       <h2 class="text-3xl font-bold text-white mb-6 text-center">C√¢u H·ªèi Th∆∞·ªùng G·∫∑p</h2>
          <div class="space-y-4">
            <div class="bg-gray-700 p-4 rounded-lg shadow">
            <h3 class="text-xl font-semibold text-white">H·ªèi: L√†m th·∫ø n√†o ƒë·ªÉ s·ª≠ d·ª•ng d·ªãch v·ª•?</h3>
            <p class="text-gray-300 mt-2">Tr·∫£ l·ªùi: B·∫°n ch·ªâ c·∫ßn nh·∫≠p v√†o ƒëo·∫°n vƒÉn b·∫£n, l·ª±a ch·ªçn c√°c t√πy ch·ªçn ph√π h·ª£p v√† nh·∫•n n√∫t "Generate", ph·∫ßn c√≤n l·∫°i AlchemistAI lo h·∫øt.</p>
          </div>
          <div class="bg-gray-700 p-4 rounded-lg shadow">
            <h3 class="text-xl font-semibold text-white">H·ªèi: D·ªãch v·ª• c√≥ h·ªó tr·ª£ t√πy ch·ªânh gi·ªçng n√≥i ho·∫∑c hi·ªáu ·ª©ng √¢m thanh kh√¥ng?</h3>
            <p class="text-gray-300 mt-2">Tr·∫£ l·ªùi: Hi·ªán t·∫°i, b·∫°n c√≥ th·ªÉ l·ª±a ch·ªçn gi·ªØa c√°c gi·ªçng ƒë·ªçc c√≥ s·∫µn v·ªõi nhi·ªÅu ng·ªØ ƒëi·ªáu v√† t·ªëc ƒë·ªô kh√°c nhau. C√°c t√≠nh nƒÉng n√¢ng cao nh∆∞ ƒëi·ªÅu ch·ªânh cao ƒë·ªô, th√™m hi·ªáu ·ª©ng √¢m thanh s·∫Ω ƒë∆∞·ª£c ph√°t tri·ªÉn trong c√°c b·∫£n c·∫≠p nh·∫≠t ti·∫øp theo.</p>
          </div>
          <div class="bg-gray-700 p-4 rounded-lg shadow">
            <h3 class="text-xl font-semibold text-white">H·ªèi: T√¥i c√≥ th·ªÉ t·∫£i v·ªÅ file √¢m thanh ƒë√£ chuy·ªÉn ƒë·ªïi kh√¥ng?</h3>
            <p class="text-gray-300 mt-2">Tr·∫£ l·ªùi: Ch·∫Øc ch·∫Øn, sau khi chuy·ªÉn ƒë·ªïi th√†nh c√¥ng, b·∫°n c√≥ th·ªÉ t·∫£i file √¢m thanh v·ªÅ thi·∫øt b·ªã ƒë·ªÉ l∆∞u tr·ªØ ho·∫∑c chia s·∫ª m·ªôt c√°ch d·ªÖ d√†ng.</p>
          </div>
        </div>
      </div>
    </section>

  </main>
  <section class="pt-5" style="background-color: #000000;">
    <div class="max-w-7xl mx-auto px-4">
      <h2 class="text-3xl font-bold text-white mb-6 text-center">Li√™n H·ªá</h2>
      <p class="text-gray-600 mb-4 text-center">N·∫øu b·∫°n c√≥ b·∫•t k·ª≥ c√¢u h·ªèi ho·∫∑c g√≥p √Ω n√†o, h√£y li√™n h·ªá v·ªõi ch√∫ng t√¥i qua
        email ho·∫∑c theo d√µi tr√™n c√°c m·∫°ng x√£ h·ªôi:</p>
      <ul class="list-disc list-inside text-gray-600 text-center">
        <li>Email: support@alchemistai.com</li>
        <li>Facebook: <a href="#" class="text-blue-600 hover:underline">AlchemistAI Official</a></li>
        <li>Twitter: <a href="#" class="text-blue-600 hover:underline">@AlchemistAI</a></li>
      </ul>
    </div>
  </section>

  <script>
    const fileInput = document.getElementById('file-upload');
    const fileDisplay = document.getElementById('file-display');
    const fileNameSpan = document.getElementById('file-name');
    const removeBtn = document.getElementById('remove-file');

    // Khi user ch·ªçn file
    fileInput.addEventListener('change', () => {
      if (fileInput.files.length) {
        fileNameSpan.textContent = fileInput.files[0].name;
        fileDisplay.classList.remove('hidden');
      } else {
        fileNameSpan.textContent = '';
        fileDisplay.classList.add('hidden');
      }
    });

    // Khi user b·∫•m X ƒë·ªÉ b·ªè file
    removeBtn.addEventListener('click', () => {
      fileInput.value = '';
      fileNameSpan.textContent = '';
      fileDisplay.classList.add('hidden');
    });
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanels = document.querySelectorAll('.tab-panel');
    const controls = document.querySelector('.controls');

    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        // 1. Update active button
        tabButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        // 2. Show the right panel, hide the others
        const target = btn.dataset.tab;
        tabPanels.forEach(panel => {
          if (panel.id === target) {
            panel.classList.add('active');
            panel.style.display = '';      // use default/display:block
          } else {
            panel.classList.remove('active');
            panel.style.display = 'none';
          }
        });

        // 3. Show or hide the controls area
        if (target === 'file-panel') {
          controls.style.display = 'none';
        } else {
          controls.style.display = '';
        }
      });
    });
    const genderSelect = document.getElementById('gender');
    const maleStyles = document.getElementById('male_styles');
    const femaleStyles = document.getElementById('female_styles');

    function updateVoiceStyles() {
      const selectedGender = genderSelect.value;
      if (selectedGender === 'male') {
        maleStyles.style.display = 'block';  // Hi·ªÉn th·ªã phong c√°ch nam
        femaleStyles.style.display = 'none'; // ·∫®n phong c√°ch n·ªØ
      } else if (selectedGender === 'female') {
        maleStyles.style.display = 'none';   // ·∫®n phong c√°ch nam
        femaleStyles.style.display = 'block'; // Hi·ªÉn th·ªã phong c√°ch n·ªØ
      }
    }
    updateVoiceStyles()
    genderSelect.addEventListener('change', updateVoiceStyles);
    document.getElementById("clearBtn").addEventListener('click', function () {
      document.getElementById('textInput').value = '';
    });
    // API call to convert text to speech
    document
      .getElementById("generateBtn")
      .addEventListener("click", sendText);
    document
      .getElementById("genFromFile")
      .addEventListener("click", sendFile);
    async function sendText() {
      // test username

      const username = localStorage.getItem('username') || sessionStorage.getItem('username');
      // l·∫•y d·ªØ li·ªáu t·ª´ form
      const text = document.getElementById("textInput").value;
      document.getElementById("textInput").value = "";
      const language = document.getElementById("language").value;
      const gender = document.getElementById("gender").value;
      let style;
      if (gender == "male") {
        style = document.getElementById("male_styles").value
      }
      else {
        style = document.getElementById("female_styles").value
      }
      const data = { username, text, language, gender, style };
      console.log(data)
      if (text.trim() === "") {
        alert("Vui l√≤ng nh·∫≠p text");
        return;
      }
      // L·∫•y audio element
      const audioElement = document.getElementById("audio-player");

      // ·∫®n audio c≈© v√† clear src tr∆∞·ªõc khi g·ª≠i
      audioElement.style.display = "none";
      audioElement.pause(); // d·ª´ng ph√°t n·∫øu ƒëang ph√°t
      audioElement.src = "";

      try {
        const response = await fetch("http://127.0.0.1:5552/api/tts_choice", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });
        const payload = await response.json();
        if (!response.ok) {
          // D√πng message t·ª´ payload.error n·∫øu c√≥
          throw new Error(payload.error || `HTTP error ${response.status}`);
        }
        const newItem = await response.json();
        //alert("ƒê√¢y l√† k·∫øt qu·∫£: " + JSON.stringify(newItem));
        audioElement.src = newItem.result;
        audioElement.style.display = "block"; // hi·ªán audio
        audioElement.load();
        audioElement.play();
        // Th√™m v√†o history containter
        addToHistory(newItem.history_item);

      } catch (err) {
        //alert("Error: " + err.message);
        console.log("Error", err)
      }
    };
    async function sendFile() {
      const username = localStorage.getItem('username') || sessionStorage.getItem('username');
      const fileInput = document.getElementById('file-upload');
      const promptInput = document.getElementById('file-prompt');

      if (!fileInput.files.length) {a
        alert('Vui l√≤ng ch·ªçn file ƒë·ªÉ upload');
        return;
      }
      const file = fileInput.files[0];
      const prompt = promptInput.value.trim();
      if (!prompt) {
        alert('Vui l√≤ng nh·∫≠p prompt ƒë·ªÉ clone gi·ªçng');
        return;
      }

      const formData = new FormData();
      formData.append('username', username);
      formData.append('text', prompt);
      formData.append('file', file);

      try {
        const res = await fetch('http://127.0.0.1:5552/tts_upload', {
          method: 'POST',
          body: formData
        });
        if (!res.ok) {
          const errText = await res.text();
          throw new Error(`Status ${res.status}: ${errText}`);
        }

        const data = await res.json();
        //alert('Upload & Train th√†nh c√¥ng:\n' + JSON.stringify(data, null, 2));
      } catch (err) {
        console.error('[sendFile] L·ªói khi fetch:', err);
        //alert('L·ªói khi upload/generate:\n' + err.message);
      }
    }


    // H√†m t√≠nh gi·ªù so v·ªõi hi·ªán t·∫°i
    function getTimeAgo(timestamp) {
      const now = Date.now();
      const diff = now - timestamp;
      const minutes = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);

      if (diff < 60000) return "V·ª´a xong";
      if (diff < 3600000) return `${minutes} ph√∫t tr∆∞·ªõc`;
      if (diff < 86400000) return `${hours} gi·ªù tr∆∞·ªõc`;
      return `${Math.floor(diff / 86400000)} ng√†y tr∆∞·ªõc`;
    };


    // H√†m t·∫°o history-item
    function createHistoryItem(item) {
      const div = document.createElement("div");
      div.className = "history-item";

      const previewText =
        item.input_text.length > 30 ? item.input_text.slice(0, 30) + "..." : item.input_text;

      //L·∫•y timestamp (t·ª©c gi·ªù generate g·ªëc) ƒë·ªÉ l√†m m·ªëc x√°c ƒë·ªãnh d√πng ƒë·ªÉ c·∫≠p nh·∫≠t realtime
      const timestamp = item.timestamp;
      //G·ªçi h√†m tr·∫£ v·ªÅ gi·ªù so v·ªõi hi·ªán t·∫°i
      const timeAgoText = getTimeAgo(timestamp);

      div.innerHTML = `
        <p title="${item.input_text}">${previewText}</p>
        <small class="time-text" data-timestamp="${timestamp}">${timeAgoText}</small>
        ${item.result
          ? `
                    <div class="audio-history-container">
                        <audio controls src="${item.result}"></audio>
                        <div class="audio-controls">
                            <a href="${item.result}" download class="audio-control-btn">
                                <i class="fas fa-download" title="Download"></i>
                            </a>
                            <button class="audio-control-btn delete-btn">
                                <i class="fas fa-trash" title="Delete"></i>
                            </button>
                        </div>
                    </div>
                `
          : ""
        }
    `;
      return div;
    };

    // Load history
    async function loadHistory(username) {
      try {
        const response = await fetch(
          `http://127.0.0.1:5552/api/history_tts?username=${encodeURIComponent(username)}`
        );
        const historyData = await response.json();

        const historyContainer = document.querySelector(".chat-history");

        // X√≥a nh·ªØng item c≈© (n·∫øu c√≥)
        const oldItems = historyContainer.querySelectorAll(".history-item");
        oldItems.forEach((item) => item.remove());

        // Th√™m l·ªãch s·ª≠ m·ªõi
        historyData.forEach((item) => {
          const div = createHistoryItem(item);
          historyContainer.appendChild(div);
        });
      } catch (err) {
        console.error("L·ªói load history:", err);
      }
    }

    // G·ªçi khi load trang (ho·∫∑c khi ƒëƒÉng nh·∫≠p xong)
    window.addEventListener("DOMContentLoaded", () => {
      const username = localStorage.getItem('username') || sessionStorage.getItem('username');
      loadHistory(username);
    });

    // Khi v·ª´a b·∫•m generate nh∆∞ng mu·ªën kh√¥ng ph·∫£i load trang ƒë·ªÉ c·∫≠p nh·∫≠t history
    function addToHistory(newItem) {
      const historyContainer = document.querySelector(".chat-history");
      const div = createHistoryItem(newItem);
      historyContainer.insertBefore(div, historyContainer.querySelector(".history-title").nextSibling);
    };

    //C·∫≠p nh·∫≠t th·ªùi gian t·ª´ng history-item theo realtime
    setInterval(() => {
      const timeElements = document.querySelectorAll('.time-text');
      timeElements.forEach(el => {
        const timestamp = Number(el.dataset.timestamp); // chuy·ªÉn r√µ r√†ng sang s·ªë
        if (!isNaN(timestamp)) {
          el.textContent = getTimeAgo(timestamp);
        }
      });
    }, 60000);

    // Avatar dropdown functionality
    
    document.addEventListener('DOMContentLoaded', function () {
      // L·∫•y t·∫•t c·∫£ c√°c n√∫t tab
      const tabButtons = document.querySelectorAll('.tab-button');

      // L·∫∑p qua t·ª´ng n√∫t tab v√† th√™m s·ª± ki·ªán click
      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          // L·∫•y ID c·ªßa panel m·ª•c ti√™u t·ª´ thu·ªôc t√≠nh data-tab c·ªßa n√∫t ƒë∆∞·ª£c nh·∫•p
          const targetPanelId = button.getAttribute('data-tab');
          const targetPanel = document.getElementById(targetPanelId);

          // Ki·ªÉm tra xem panel m·ª•c ti√™u c√≥ t·ªìn t·∫°i kh√¥ng
          if (!targetPanel) {
            console.error("Kh√¥ng t√¨m th·∫•y panel v·ªõi ID:", targetPanelId);
            return; // N·∫øu kh√¥ng t√¨m th·∫•y, d·ª´ng th·ª±c thi
          }

          // --- C·∫≠p nh·∫≠t tr·∫°ng th√°i active cho c√°c n√∫t ---
          // 1. X√≥a l·ªõp 'active' kh·ªèi T·∫§T C·∫¢ c√°c n√∫t tab
          tabButtons.forEach(btn => {
            btn.classList.remove('active');
          });
          // 2. Th√™m l·ªõp 'active' v√†o n√∫t V·ª™A ƒê∆Ø·ª¢C NH·∫§P
          button.classList.add('active');

          // --- C·∫≠p nh·∫≠t hi·ªÉn th·ªã cho c√°c panel ---
          // 1. L·∫•y t·∫•t c·∫£ c√°c panel (l√† con tr·ª±c ti·∫øp c·ªßa .tab-content v√† c√≥ ID)
          //    S·ª≠ d·ª•ng class .tab-panel s·∫Ω t·ªët h∆°n n·∫øu c√≥
          const allPanels = document.querySelectorAll('.tab-content > .tab-panel'); // S·ª≠ d·ª•ng class .tab-panel
          // 2. ·∫®n T·∫§T C·∫¢ c√°c panel
          allPanels.forEach(panel => {
            panel.style.display = 'none';
            // Ho·∫∑c n·∫øu d√πng class: panel.classList.remove('active');
          });
          // 3. Hi·ªÉn th·ªã panel M·ª§C TI√äU
          targetPanel.style.display = 'block'; // Ho·∫∑c 'flex', 'grid' t√πy thu·ªôc v√†o CSS
          // Ho·∫∑c n·∫øu d√πng class: targetPanel.classList.add('active');
        });
      });
    });
  </script>
  <script src="./js/header.js"></script>
  <script src="./js/speech-to-text.js"></script>
  <script src="./js/chatbot.js"></script>
</body>

</html>
